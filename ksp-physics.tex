% KSP Physics Documentation by Mhoram
% This work is licensed under the Creative Commons
% Attribution-NonCommercial-ShareAlike 4.0 International License.
\documentclass[11pt]{report}

\usepackage[utf8]{inputenc}
\usepackage[a4paper]{geometry}
\usepackage[pdfstartview=Fit,pdfpagelayout=SinglePage,breaklinks=true]{hyperref}
\usepackage{breakurl}
\usepackage{multicol}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[final]{listings}
\usepackage{makeidx}
\makeindex
\usepackage[nottoc]{tocbibind}

\newcommand{\oa}[1]{\overrightarrow{#1}}
\newcommand{\dv}{{\Delta}{v}}
\newcommand{\isp}{I_{SP}}
\newcommand{\ispi}[1]{I_{SP_{#1}}}
\newcommand{\F}[1]{\oa{F_{#1}}}
\newcommand{\Pos}{\oa{P}}
\newcommand{\Vel}{\oa{V}}
\newcommand{\absvec}[1]{\left|\left|{#1}\right|\right|}
\newcommand{\dddvec}[3]{\left(\begin{smallmatrix}{#1}\\{#2}\\{#3}\end{smallmatrix}\right)}

\DeclareMathOperator{\atan2}{atan2}
\DeclareMathOperator{\Lat}{Lat}
\DeclareMathOperator{\Lon}{Lon}

\immediate\write18{git describe --tags | sed -e "s/v//" -e "s/^\string\([0-9]\string\+[.][0-9]\string\+\string\)$/\string\1.0/" -e "s/-/./" -e "s/-.\string\+//" > .tagversion} % $

\setcounter{chapter}{-1}

\begin{document}

\title{Documentation of KSP Physics\\\small{Version \input{.tagversion}}\\\vspace{1 em}\url{https://github.com/mhoram-kerbin/ksp-physics-documentation}\\\url{http://forum.kerbalspaceprogram.com/threads/93426-Physics-of-KSP}}
\author {Mhoram Kerbin \href{mailto:mhoram.kerbin@gmx.de}{\nolinkurl{mhoram.kerbin@gmx.de}}}

\maketitle

\begin{abstract}

  This document summarizes the stock physics of Kerbal Space Program
  \cite{KSP}. It should be valid for versions 0.21 to 0.25.0. Some
  equations are also applicable to real life situations - if you ever
  happen to stumble into one.

\end{abstract}

\tableofcontents

\chapter{Preface}

\section{Introduction}

During my attempts to use PSOPT as a method for generating ideal
ascent trajectories for rockets, I needed to implement the physics of
KSP in C/C++. So I had to gather all the physics related information
again after my Ascent Optimizer Perl-project \cite{PAO}. Since they
are available at quite different places, this document is intended to
summarize them in a single central place.

\section{Document Structure}

Part \ref{InnerWorkings} describes how the Physics Engine of KSP
works. Part \ref{InGamePhysics} describes how some in game physical
properties can be calculated. Appendix \ref{RealWorldDifferences}
contains a desription of the differences between the real world and
KSP-Physics.

\section{Contributions}

I want to thank the following people for helping to improve this
document.

\begin{itemize}
\item \href{http://forum.kerbalspaceprogram.com/members/2521}{Arrowstar} (Reference Frames)
\end{itemize}

\section{Relevance for Physics-Changing Addons}

FAR \cite{FAR} and NEAR \cite{NEAR} implement a completely different
atmosphere and only the non-atmospheric descriptions of this text can
be applied to them.

While Principia \cite{principia} intends to change the orbital
mechanics completely it remains to be seen how much of the rest of
this text can be applied to it.

\section{Basic Knowledge}

For getting along with this document besides knowledge about
mathmatics and physical units a basic understanding of the following
aspects is required.
\begin{itemize}
\item Euclidian Vectors \cite{EuclidianVectors} and Vector Operations
  including scalar product \cite{ScalarProduct} and cross product
  \cite{CrossProduct}
\item Trigonometric functions \cite{TrigonometricFunctions}
\item Differentiation including Newton's notation \cite{Differentiation}
\item Exponentiation \cite{Exponentiation} and Logarithm \cite{Logarithm}
\end{itemize}

\part{Inner Workings of KSP}\label{InnerWorkings}

\chapter{Conventions}

We denote by $\Pos$, $\Vel$, $d$ and $M$ the \index{Position Vector}
position vector, \index{Velocity Vector} velocity vector, drag
coefficient and the mass of the ship respectively.

$\Pos_X, \Pos_Y \textrm{ and } \Pos_Z$ denote the X, Y and Z
components of the vector $\Pos$.

The Z-Axis points from the planets core to the northpole.

Distance denotes the distance to the planets center and altitude the
distance to the surface sea level.


\chapter{Physical Constants}

\section{Global Constants}

The \index{conversion factor} conversion factor between pressure and
density is according to \cite{Atmo}.

\begin{align}
  CF &:= 1.2230948554874 \frac{kg}{m^3\cdot atm}
\end{align}

The \index{gravitational constant} gravitational constant $G$ is according to \cite{ACB}.
\begin{align}
  G &:= 6.674E-11 N\left(\frac{m}{kg}\right)^2
\end{align}

\section{Planets}

Planets are defined by the following parameters

\begin{itemize}
\item Name
\item \index{Mass of Planet} Mass of Planet $PMass^{(Name)}$ in kg
\item \index{Planetary Radius} Planetary Radius $PRadius^{(Name)}$ in m
\item \index{Scale Height} Scale Height $PSH^{(Name)}$ in m
\item \index{Pressure at Sealevel} Pressure at Sealevel $p_0^{(Name)}$ in atm
\item \index{Rotation Period} Rotation Period $RP^{(Name)}$ in s
\item \index{Sphere of Influence} Radius of Sphere of Influence $Soi^{(Name)}$ in m \footnote{It should be noted that the Sphere of Influence is actually calculated
as described in \cite{SphereOfInfluence}.}
\end{itemize}

The KSP Wiki \cite{Wiki} contains information about each celestial
body.

\subsection{Kerbin}

According to the KSP Wiki for Kerbin the values are:

\begin{align*}
  PMass^{(Kerbin)} &:= 5.2915793E22 kg\\
  PRadius^{(Kerbin)} &:= 600000 m\\
  PSH^{(Kerbin)} &:= 5000 m\\
  p_0^{(Kerbin)} &:= 1 atm\\
  RP^{(Kerbin)} &:= 21600 s\\
  Soi^{(Kerbin)} &:= 84159286 m\\
\end{align*}

\chapter{Atmosphere}

\section{Atmospheric Formula}

Now we will show how several atmospheric parameters are calculated
based on \cite{Atmo}.
\begin{align}
  \index{Atmospheric Height} \textrm{AtmosphericHeight}\nonumber\\
  AH^{(Name)} &:= -\ln\left(10^{-6}\right)\cdot PSH^{(Name)}\label{AtmosphericHeightEquation}\\
  \index{Pressure} \textrm{Pressure at altitude }&\nonumber\\
  p(alt) &:=
  \left\{
      \begin{array}{l l}
        p_0^{(Name)} \cdot \exp\left({\frac{-alt}{PSH^{(Name)}}}\right) & \textrm{if } alt < AH^{(Name)}\\
        0 &\textrm{if } alt \geq AH^{(Name)}
      \end{array}
    \right.\\
    \index{Density} \textrm{Density at altitude}\nonumber\\
    \rho(alt) &:= CF \cdot p(alt)
\end{align}


\section{Lift}

The best description of \index{Lift} lift can be found in the ``How to
calculate lift?'' thread \cite{Lift}

\section{Air Intake}

Jet Engines need the resource Intake Air \index{Intake Air}
\cite{IntakeAir} to run. This resource is harvested by Air Intakes
\cite{Air Intakes} while flying in an atmosphere that contains Oxygen.

There are several factors influencing the amount of IntakeAir
gathered. While the exact formula is unknown yet, some relations are
more or less established. \cite{AirIntakeModel},
\cite{IntakesDifference}

\begin{itemize}
\item Intake Area is directly proportional to the amount
\item Surface Velocity is probably directly proportional to the amount
\item Atmospheric Pressure is probably directly proportional to the
  amount
\item Angle of Attack is probably in a cosinus relation to the amount
\end{itemize}

\chapter {Surface}

\section{Latitude and Longitude conversion}

From a Position Vector $\Pos$ we can calculate \index{Latitude}
latitude and \index{Longitude} longitude by the following formula:

\begin{align}
  \Lon(\Pos) &:= \arctan\left(\frac{\Pos_Y}{\Pos_X}\right)\\
  \Lat(\Pos) &:= \arctan\left(\frac{\Pos_Z}{\sqrt{\Pos_X^2+\Pos_Y^2}}\right)
\end{align}

Be advised that this happens to be only true if the inertial X is
aligned with body X at t = 0. That's not the case for most KSP planets
and moons. \cite{LatLongNote}

\section{Surface Velocity}

Due to the rotation of the planet, the \index{Surface Velocity}
surface velocity is different from the orbital speed.

The difference between the two speed vectors $DiffV(\Pos)$ is the
projected planets rotation to the position $\Pos$ of the rocket.

We can convert orbital $\Vel$ to surface velocity $\oa{SV}$
vectors with the following equation if we know the position $\Pos$.

\begin{align}
  DiffV(\Pos) &:= \absvec{\Pos} \cdot \frac{2 \pi}{RP^{(Name)}} \cdot \cos\left(\Lat\left(\Pos\right)\right)\cdot\left(\begin{smallmatrix}-\sin(\Lon(\Pos)\\\cos(\Lon(\Pos))\\0\end{smallmatrix}\right)\nonumber\\
  \oa{SV} &= \Vel - DiffV(\Pos)
\end{align}

\chapter{Forces}

There are three forces that effect the flightpath of a rocket, namely
Drag, Gravity and Thrust. This chapter details them.

\section{Drag}

\index{Drag} Drag is the force applied to rocket based on the movement
through the atmosphere and it is directed in an opposite direction to
the movement.

It should be notet that since the atmosphere rotates with the planet,
the surface velocity is the relevant velocity and not the orbital
velocity.

\subsection{Drag Coefficient}

In KSP $d$ is the \index{Drag Coefficient} drag coefficient of the
rocket. It is a mass-based average of the drag coefficients of all
parts of the rocket and is dimensionless.

It indicates how much it is decellerated by means of air friction.

Usually it is near to $0.2$.

Consider a rocket consisting of a Mk1 Cockpit (dry mass of 1.25 ton,
drag coefficient of 0.1), a FL-T800 Fuel Tank (total mass of 4.5 ton,
drag coefficient of 0.2) and a LV-909 Liquid Fuel Engine (total mass
of 0.5 ton, drag coefficient of 0.2). For this rocket the drag
coefficient is:
\begin{align}
  d &= \frac{1.25 \cdot 0.1 + 4.5 \cdot 0.2 + 0.5 \cdot 0.2}{ 1.25 + 4.5 + 0.5 }\nonumber\\
  &= \frac{1.125}{6.25}\nonumber\\
  &= 0.18\nonumber
\end{align}

\subsection{Drag Force}\label{DragForce}

Since the drag force $\F{D}$ is directly proportional to the
cross-sectional area $A$ of the rocket and this value is approximated
in KSP by $A = 0.008 \frac{m^2}{kg} \cdot M$ we get

\begin{align}
  \F{D} &:= - 0.5 \cdot \rho(alt)\cdot \absvec{\oa{SV}}^2\cdot d \cdot 0.008\frac{m^2}{kg} \cdot M \cdot \frac{\oa{SV}}{\absvec{\oa{SV}}} \nonumber\\
  &= - 0.5 \cdot \rho(alt)\cdot d \cdot 0.008\frac{m^2}{kg} \cdot M \cdot \absvec{\oa{SV}} \cdot \oa{SV}
\end{align}

\section{Gravity}

The \index{Gravity} gravity force $\F{G}$ is directed towards the
planets core and gets lower with increasing distance.

\begin{align}
  \mu^{(Name)} = LocalGravityParameter^{(Name)} &:= G \cdot PMass^{(Name)} \nonumber\\
  LocalGravity(distance) &:= \frac{LocalGravityParameter}{distance^2}\label{LocalGravityEquation}\\
  \F{G} &:= - M \cdot \mu^{(Name)}\cdot\frac{\Pos}{\absvec{\Pos}^3}
\end{align}

\section{Engines}

\subsection{Rocket Engines}

The \index{ISP} Specific impulse $\isp$ (in seconds) describes the
engine efficiency and is parameterized for an engine by ISP at
sealevel and ISP in vacuum.

The ISP is linear in the pressure $p$ and cut off at $1atm$
(citation needed).  We can calculate the ISP based on the pressure
$p$ by
\begin{align}
  np(p) &:= \min(1 atm, p)\\
  ISP(p) &:= ISP_{1atm} \cdot np(p) + ISP_{VAC} \cdot (1-np(p))
\end{align}

According to \cite{ECF} the conversion factor $g_0$ is not
$9.81\frac{m}{s^2}$, but
\begin{align}
  g_0 &\approx 9.82\frac{m}{s^2}
\end{align}

So we get a fuel consumption $\dot{M}$ (change of mass) \cite{SPI} of:
\begin{align}
\dot{M} & := \frac{\absvec{\oa{F_T}}}{ISP \cdot g_0}\label{FuelConsumptionEquation}
\end{align}

\subsection{Jet Engines}

Jet Engines are described in a nonlinear way. Details can be found in
the ``Fuel consumption as a function of atmospheric pressure`` thread
\cite{JetEngines}

\subsection{ISP Calculation}

A ship with multiple engines that have different ISP-profiles has an
averaged ISP that is based on the ISP of all running engines.

The calculation of the ships ISP is described on the wiki
\cite{MulEng}.

A ship with $n$ running engines, where each engine $i$ has a thrust of
$F_{T_i}$ and a specific impulse of $\ispi{i}$ has a total ISP of:

\begin{align}
  \isp := \frac{\sum_i{F_{T_i}}}{\sum_i{\frac{F_{T_i}}{\ispi{i}}}}
\end{align}

\subsection{Engine Thrust}

The total \index{Thrust} ship thrust $\F{T}$ with $n$ running engines
with thrusts $\F{T_i}$ is

\begin{align}
  \F{T} & := \sum_{i}\F{T_i}\label{enginethrust}
\end{align}

This equation assumes that the engines do not induce a rotation onto
the rocket. If this is however the case then the total thrust is lower
than calculated in \eqref{enginethrust}.

It should also be noted that this equation is a vectoraddition,
meaning that the orientation of the engines is important.

\section{Nomenclature}

We will use the following abbreviations for the scalar thrust.

\begin{align}
  F_D := \absvec{\oa{F_D}}\nonumber\\
  F_G := \absvec{\oa{F_G}}\nonumber\\
  F_T := \absvec{\oa{F_T}}\nonumber
\end{align}

\chapter{Acceleration}

The rocket is subect to the three forces drag $\F{D}$, gravity $\F{G}$
and thrust $\F{T}$.  The \index{Acceleration} acceleration as a vector
$\oa{a}$ that the rocket experiences based on these forces is:

\begin{align}
  \oa{a} &:= M^{-1} \cdot(\F{D} + \F{G} + \F{T})
\end{align}

\chapter{Ship Rotation}

There are several forces that induce a rotation on a ship.

\begin{itemize}
\item \index{Torque} Torque from SAS modules and most command pods
\item Engines that are not aligned with the center of mass
\item \index{Gimbal} Gimbal of engines
\item Drag on rocketparts
\item Lift on rocketparts (Wings \& control surfaces)
\item Steerable wheels on the ground
\item Colisions with other objects
\end{itemize}

At the time of this writing there is to my knowledge no
community-based comparison of the quantities of these effects
available.

The best description of Torque can be found in the ``If something has
an SAS torque of `20', what does that actually mean?'' thread
\cite{torque}.

\chapter{Coordinate Conversion}

An \index{Orbit} Orbit can be described either by \index{Cartesian
  Coordinates} cartesian coordinates of a position vector $\Pos$ and a
velocity vector $\Vel$ or by \index{Kepler Orbit} Kepler Elements
\cite{Kepler} that consist of

\begin{itemize}
\item \index{Semi-major axis} Semi-major axis ($a$)
\item \index{Eccentricity} Eccentricity ($e$)
\item \index{Inclination} Inclination ($i$)
\item \index{Ascending node} Longitude of the ascending node ($\Omega$)
\item \index{Argument of periapsis} Argument of periapsis ($\omega$)
\item True Anomaly ($\nu$), Mean Anomaly ($M$) or Eccentric Anomaly ($E$)
\end{itemize}

In KSP, Kepler Elements are used for objects that are on rails and
Cartesian Coordinates for the ship you currently steer and others in
its vicinity.

This chapter contains a description of the conversion between Kepler
and Cartesian coordinates.

In order to convert between the two representations, it is necessary
to keep the reference frames in order.

\section{Kepler-Orbit-Position
  Conversions} \label{KeplerOrbitPositionConversions}

For a Kepler Orbit there are three aequivalent parameters that
describe the position of an object on the orbit.

\begin{itemize}
\item \index{True Anomaly} True Anomaly ($\nu$) \cite{TrueA}
\item \index{Mean Anomaly} Mean Anomaly ($M$) \cite{MeanA}
\item \index{Eccentric Anomaly} Eccentric Anomaly ($E$)
  \cite{EccentricA}
\end{itemize}

All of them are useful for different purposes. This chapter deals with
converting them.

Note that we use $M$ for both, Rocketmass and Mean Anomaly. The
context usually indicates which of both is the intended one.

There are other equivalent parameterizations possible, like for
example time since Periapsis.

KSP savegames store \cite{KspSaveOrbit} this information with a
reference to epoch, namely

\begin{itemize}
\item MNA: Mean anomaly at Epoch - the position of the orbiting
  body along the ellipse at a specific time
\item EPH: Epoch - the reference time for the orbit
\end{itemize}


\subsection{True Anomaly to Eccentric Anomaly} \label{ta2ea}

The Eccentric Anomaly $E$ can be calculated from the True Anomaly $\nu$
and Eccentricity $e$ by the formula
\begin{align}
  \tan(E) & = \frac{\sqrt{1-e^2}\cdot \sin(\nu)}{e+\cos(\nu)}\nonumber\\
  E & = \atan2\left(\sqrt{1-e^2}\cdot \sin(\nu), e+\cos(\nu)\right)
\end{align}

\subsection{Mean Anomaly to Eccentric Anomaly} \label{ma2ea}

We calculate the eccentric Anomaly $E$ by the formula $M = E - e\cdot
\sin(E)$. Since this equation does not have a closed-form solution for
$E$, we use the Newton-Raphson method \cite{NeRaMe} to approximate the
solution.

In order to start the iteration, we need some initial values.
\begin{align}
  MaxError & := 10^{-13}\nonumber\\
  target & := \left\{
    \begin{array}{l l}
      \pi & \textrm{if } e > 0.8\\
      M & \textrm{otherwise}
    \end{array}
  \right.\nonumber\\
  error & := target - e\cdot\sin(target) - M\nonumber
\end{align}

After that we apply the following steps \eqref{NeRaBegin} to \eqref{NeRaEnd} until $|error| < MaxError$ or
the procedure has found no solution within a specified number of runs.
\begin{align}
  prev & := target\label{NeRaBegin}\\
  target & := prev - \frac{error}{1 - e\cdot \cos(prev)}\\
  error & := target - e \cdot\sin(target) - M\label{NeRaEnd}
\end{align}

The resulting Eccentric anomaly is $E := target$.

\subsection{Eccentric Anomaly to True Anomaly} \label{ea2ta}

We get the True Anomaly by the formula

\begin{align}
\tan\left(\frac{\nu}{2}\right) & = \sqrt{\frac{1+e}{1-e}} \cdot \tan\left(\frac{E}{2}\right)\nonumber\\
\nu & = 2\cdot\atan2\left(\sqrt{1+e}\cdot \sin\left(\frac{E}{2}\right), \sqrt{1-e}\cdot \cos\left(\frac{E}{2}\right)\right)
\end{align}

\subsection{Eccentric Anomaly to Mean Anomaly} \label{ea2ma}

We get the Mean Anomaly from the Eccentric Anomaly and the
Eccentricity by the formula

\begin{align}
M & = E - e\cdot \sin(E)
\end{align}

\subsection{True Anomaly to Mean Anomaly}

Use the methods in chapters \ref{ta2ea} and \ref{ea2ma}.

\subsection{Mean Anomaly to True Anomaly}

Use the methods in chapters \ref{ma2ea} and \ref{ea2ta}.

\section{Cartesian to Kepler}

We can convert cartesian to kepler coordinates by the following
equations that are explained in \cite{RSCK}, where $\mu^{(Body)}$
denotes the gravitational Parameter of the planet, $\oa{h}$ the
\index{Orbital Momentum} orbital momentum vector and $\oa{e}$ the
eccentricity vector.

As reference frames we assume that inertial X is aligned with body X
at t = 0.

\begin{align}
  a &:= \left(2\cdot\absvec{\Pos}^{-1} - \frac{\absvec{\Vel}^2}{\mu^{(Body)}}\cdot \right)^{-1}\\
  \oa{h} &:= \Pos \times \Vel\nonumber\\
  \oa{e} &:= \frac{\Vel\times \oa{h}}{\mu^{(Body)}} - \absvec{\Pos}\nonumber\\
  e &:= \absvec{\oa{e}}\\
  i &:= \arccos\left(\frac{\oa{h}_Z}{\absvec{\oa{h}}} \right)\\
  \oa{n} & := \dddvec{0}{0}{1} \times \oa{h} = \dddvec{-\oa{h}_Y}{\oa{h}_X}{0}\nonumber\\
  \Omega &:= \left\{
    \begin{array}{l l}
      0 & \textrm{if } \absvec{\oa{n}} = 0\\
      \arccos\left(\dddvec{1}{0}{0}\cdot\frac{\oa{n}}{\absvec{\oa{n}}} \right) & \textrm{if } \oa{n}_Y = \oa{h}_X >= 0\\
      2\pi - \arccos\left(\dddvec{1}{0}{0}\cdot\frac{\oa{n}}{\absvec{\oa{n}}} \right) & \textrm{otherwise}
    \end{array}
    \right.\\
  \omega & := \left\{
    \begin{array}{l l}
      0 & \textrm{if } \absvec{\oa{n}} = 0\\
      \arccos\left(\frac{\oa{n}\cdot\oa{e}}{\absvec{\oa{n}}\cdot\absvec{\oa{e}}} \right) & \textrm{if } \oa{e}_Z >= 0\\
      2\pi - \arccos\left(\frac{\oa{n}\cdot\oa{e}}{\absvec{\oa{n}}\cdot\absvec{\oa{e}}}\right) & \textrm{otherwise}
    \end{array}
    \right.\\
    \nu &:= \left\{
    \begin{array}{l l}
      \arccos\left(\frac{\Pos\cdot\oa{e}}{\absvec{\Pos}\cdot\absvec{\oa{e}}}\right) & \textrm{if } \Pos\cdot\Vel >= 0\\
      2\pi - \arccos\left(\frac{\Pos\cdot\oa{e}}{\absvec{\Pos}\cdot\absvec{\oa{e}}}\right) & \textrm{otherwise}
    \end{array}
    \right.
\end{align}

\section{Kepler to Cartesian}

We can also convert kepler to cartesian coordinates by the following
equations that are explained in \cite{RSKC}, where $\mu^{(Body)}$
denotes the Gravitational Parameter of the planet.

Use the formulas in chapter \ref{KeplerOrbitPositionConversions} to
get the True Anomaly $\nu$ and Eccentric Anomaly $E$. In this
calculation $\oa{o}$ and $\dot{\oa{o}}$ denote the position and
velocity vector within the \index{Orbital Frame of Reference} orbital
frame of reference.

As reference frames we assume that inertial X is aligned with body X
at t = 0.

\begin{align}
  \absvec{\oa{o}} & := a(1-e \cdot \cos(E))\nonumber\\
  \oa{o} & := \absvec{\oa{o}} \dddvec{\cos(\nu)}{\sin(\nu)}{0}\nonumber\\
  \dot{\oa{o}} & := \frac{\sqrt{\mu^{(Body)} a}}{\absvec{\oa{o}}} \dddvec{-\sin(E)}{\sqrt{1-e^2}\cos(E)}{0}\nonumber\\
  \Pos & := \dddvec{\oa{o}_X(\cos(\omega)\cos(\Omega)-sin\omega\cos(i)\sin(\Omega)) - \oa{o}_Y(\sin(\omega)\cos(\Omega)+\cos(\omega)\cos(i)\sin(\Omega))}{\oa{o}_X(\cos(\omega)\sin(\Omega)+sin\omega\cos(i)\cos(\Omega)) - \oa{o}_Y(\cos(\omega)\cos(i)\cos(\Omega)-\sin(\omega)\sin(\Omega))}{\oa{o}_X(\sin(\omega)\sin(i))+\oa{o}_Y(cos\omega\sin(i))}\\
  \Vel & := \dddvec{\dot{\oa{o}}_X(\cos(\omega)\cos(\Omega)-sin\omega\cos(i)\sin(\Omega)) - \dot{\oa{o}}_Y(\sin(\omega)\cos(\Omega)+\cos(\omega)\cos(i)\sin(\Omega))}{\dot{\oa{o}}_X(\cos(\omega)\sin(\Omega)+sin\omega\cos(i)\cos(\Omega)) - \dot{\oa{o}}_Y(\cos(\omega)\cos(i)\cos(\Omega)-\sin(\omega)\sin(\Omega))}{\dot{\oa{o}}_X(\sin(\omega)\sin(i))+\dot{\oa{o}}_Y(cos\omega\sin(i))}
\end{align}

\section{KSP coordinate conversion}

Depending on the location of the ship, different references for the
Cartesian coordinate system are used. This chapter describes them once
it is finished.

\part{Physics in the Game}\label{InGamePhysics}

\chapter{In Space}

\section{Orbital Mechanics}

\subsection{Apsides}

We can calculate the \index{Apoapsis} apoapsis $r_A$ and
\index{Periapsis} periapsis $r_P$ (in the meaning distance to the
Planets center) as

\begin{align}
r_A & := a \cdot (1 + e)\\
r_P & := a \cdot (1 - e)
\end{align}

Conversely we can calculate the semi-major axis and eccentricity as

\begin{align}
  a & := \frac{1}{2}\cdot(r_A + r_P)\\
  e & := \frac{r_A}{a} - 1\\
  e & := 1 - \frac{r_P}{a}
\end{align}

\subsection{Orbital Velocities} \label{OrbitalVelocities}

The velocity $V$ of an object that orbits a Body and has a distance
$r$ to the Planets center is according to the Vis-viva equation
\cite{VisViva}

\begin{align}
V & := \sqrt{\mu^{(Body)} \cdot \left(\frac{2}{r} - \frac{1}{a}\right)}
\end{align}

It should be noted that the speed reaches it's maximum at Periapsis
and minimum at Apoapsis and that the disctance $r$ lies within the
bounds

$$
r_P \leq r \leq r_A
$$

In the case of a circular orbit, the speed is equal at all points on
the orbit.

For the calculation of the velocity at the border of the SOI the above
formula can be used, but the calculation of the semi-major axis $a$ is
different.


\subsection{Orbital Period}

The \index{Orbital Period} orbital period (with the meaning of
\index{Siderial Period} sidereal period \cite{SIDPER}) around a Body
is

\begin{align}
SiderealPeriod := 2\pi\sqrt{\frac{a^3}{\mu^{(Body)}}}
\end{align}

\section{Orbital Darkness Time}

A ship orbiting a Body will spend some time in the shadow of this
body. \index{Orbital Darknes Time}

The maximal possible time $T_d$ in darkness can be approximated as
described in \cite{DarknessTime}.

\begin{align}
  b & := \sqrt{r_A \cdot r_P} \textrm{ the semi-minor axis}\index{Semi-minor axis}\\
  l & := 2\frac{r_A\cdot r_P}{r_A + r_P} \textrm{ the semi-latus rectum} \index{Semi-latus rectum}\\
  h & := \sqrt{l\mu^{(Name)}} \textrm{ the specific angular momentum}\index{Specific angular momentum}\\
  T_d &:\approx \frac{2ab}{h}\left(\arcsin\left(\frac{PRadius^{(Name)}}{b}\right)+\frac{e\cdot PRadius^{(Name)}}{b}\right)
\end{align}

Note that this is the darkness time for the case that the Apoapsis is
in the center of the shadow. The time can be much lower if the
Periapsis is in the shadow.

In order to calculate the longest time that a ship can be without
sunlight, the other planetary bodies have to be taken into acount.

\section{Geostationary Orbits}

A geosynchronous orbit \index{Geosynchronous Orbit}
\cite{GeosynchronousOrbit} is an orbit with an orbital period that
equals the duration of one sidereal day.

A geostationary orbit \index{Geostationary Orbit} \cite{GeostationaryOrbit} is a special case of
a geosynchronous orbit with an inclination of $i=0$ that is also
circular.

To calculate the altitude of a geostationary orbit $a_G$ we use the
following approach.

\begin{align}
  Rotation Period & = Orbital Period\nonumber\\
RP^{(Name)} & = 2\pi\sqrt{\frac{(a_G+PRadius^{(Name)})^3}{\mu^{(Body)}}}\nonumber\\
a_G & = \sqrt[3]{\left(\frac{RP^{(Name)}}{2\pi}\right)^2\cdot\mu^{(Body)}}-PRadius^{(Name)}
\end{align}

\chapter{Engine Calculations}

\section{Delta-V}

Delta-V or $\dv$ \index{Delta-V} \cite{DeltaV} is a measurement of how
much fuel is needed to reach a destination. The thread ``What Is Delta
V?''  \cite{WhatIsDeltaV} contains answers from different points of
view that try to explain it.

Using Tsiolkovsky rocket equation \cite{TsiolkovskyRocketEquation},
\cite{TsiolkovskyKSP} we can calculate the Delta-V a ship has, given
its initial mass $m_0$, its dry mass $m_1$ and its $\isp$.

\begin{align}
\dv := \ln\left(\frac{m_0}{m_1}\right) \cdot \isp \cdot g_0\label{TsiolkovskyEquation}
\end{align}

This formula is much more useful in vacuum than in the atmosphere,
because $\isp$ depends on the pressure and the pressure changes with
altitude within the atmosphere. And note that this formula is only
correct within a single stage.

\section{Delta-V Upper Bound}

The maximal theoretical possible amount of Delta-V $\dv_M$ within a
single stage can be calculated based on the $\isp$ of the engines
within this stage and an upper bound of the full fueltank : dry
fueltak mass ratio. Fuel tanks in KSP have an upper bound for this
ratio of $9:1$.

\begin{align}
  \dv_M & < \ln\left(\frac{9}{1}\right) \cdot \isp \cdot g_0\nonumber\\
  & = \ln(9) \cdot \isp \cdot g_0\nonumber\\
  & \approx \left\{
    \begin{array}{r l}
      4747 \frac{m}{s} & \textrm{for LV-N Atomic Rocket Motor on Kerbins Sealevel}\\
      6904 \frac{m}{s} & \textrm{for Mainsail on Kerbins Sealevel}\\
      7551 \frac{m}{s} & \textrm{for Rockomax 48-7S in vacuum}\\
      8414 \frac{m}{s} & \textrm{for LV-909 or Toroidal Aerospike Rocket in vacuum}\\
      17261 \frac{m}{s} & \textrm{for LV-N Atomic Rocket Motor in vacuum}
    \end{array}
  \right.
\end{align}

Note however that these bounds are far from reality, since they do not
account for Engine or payload mass and induce a ridiculously low
$TWR$.  Ships that have an average vacuum $\dv$ of $7000 \frac{m}{s}$
per stage are feasible. \cite{DeltaVMaximizationChallenge}

\section{Burn Duration}

Given $\dv$ and a ship configuration as mass of the ship before
the burn $M$, Specific impulse $\isp$ \footnote{Remember that the
  Specific impulse depends not only on the engines but also on the
  pressure.} and the thrust $F_T$ it is possible to
calculate the duration of the burn $T_B$. \index{Burn Duration}

Using \eqref{FuelConsumptionEquation} we can calculate the
Fuelconsumption $\dot{M}$ in $\frac{kg}{s}$.

In order to calculate the total amount of fuel used $M_F$ during the
burn, we use equation \eqref{TsiolkovskyEquation}.

\begin{align*}
  \dv & = \isp\cdot g_0 \cdot \ln\left(\frac{M}{M-M_F}\right)
\end{align*}
so we get
\begin{align}
  M_F & = M-\frac{M}{\exp\left(\frac{\dv}{\isp\cdot g_0}\right)}\nonumber\\
  & = M\left(1-\exp\left(-\frac{\dv}{\isp\cdot g_0}\right)\right)
\end{align}
and can calculate the burn time
\begin{align}
  T_B & = \frac{M_F}{\dot{M}}\nonumber\\
  & = \frac{M}{F_T}\cdot \isp \cdot g_0\left(1-\exp\left(-\frac{\dv}{\isp\cdot g_0}\right)\right)
\end{align}

Note however that this is only valid if the current stage in the
rocket has enough $\dv$ for the complete burn.

\section{Thrust to Weight Ratio}

The Thrust to Weight ratio \index{Thrust to Weight Ratio} TWR
\cite{KspTwr} of a ship with mass $M$ and thrust $F_T$ is a simple yet
complex measurement.

Simple in the meaning that it can be calculated easily
as
\begin{align}
  TWR := \frac{F_T}{M\cdot g}
\end{align}

where $g$ denotes the gravitational acceleration.

Complex because of the choice of $g$. $g$ can be selected in different
ways that makes it difficult to talk about, if it is not specified
what is meant. Some versions are:

\begin{itemize}
\item $g$ is the gravity at Sealevel on Kerbin
\item $g$ is the local gravity at the position of the ship
  $LocalGravity(distance)$ as calculated in
  \eqref{LocalGravityEquation}
\item $g$ is the gravity at the Sealevel of the Body, the ship is
  currently orbiting
\end{itemize}

For launching a rocket from the launchpad it is necessary that $TWR >
1$. In this case $g$ is nearly equal for all variants. Within a single
stage of a ship the TWR always increases because of the decreasing
fuel mass.

\chapter{Ascent Calculations}

\section{General notes}

We use ``ideal'' in the meaning optimized for fuel usage in this
chapter.

For a rocket the amount of fuel needed for ascending from Kerbins
Sealevel to an orbit depends on several factors including

\begin{itemize}
\item Rocket staging configuration
\item Ascent Path
\end{itemize}

Since these factors are quite variable, it should be noted that there
is no single ideal ascent trajectory that fits to all rockets.

That being said, Rockets that have similar TWR-configurations have
similar ideal ascent paths.

\section{Payload Fraction}

The payload fraction $f_P$ of a rocket is the payload mass $m_P$ divided by
the mass at launch $m_L$.
\begin{align}
  f_P := \frac{m_P}{m_L}
\end{align}

We define the payload mass as the mass of the parts of the rocket that
stay in orbit after launch and are not used in any way to help with
the ascent. For example a engine that is ignited before reaching orbit
is not considered for the payload mass.

In stock KSP payload fractions above 20\% have been reached on
Kerbin. \cite{PayloadFractionChallenge}

\section{Delta-V Requirements}

As stated in \cite{AscentDeltaVApproximation} the amount $\dv_L$ of
Delta-V needed to ascend from sealevel to a stable orbit above the
atmosphere can be approximated by the sum of
\begin{itemize}
\item Orbital Speed $v_o$ on an orbit above the atmosphere with a
  radius $r_o$
\item drag losses during a vertical ascent $\dv_D$
\item gravity losses during a vertical ascent $\dv_G$
\end{itemize}

While the orbital speed can be calculated as stated in chapter
\ref{OrbitalVelocities}, the other two can be approximated in the
following way. \cite{AscentDeltaVApproximationFormula}

\begin{align}
  \dv_D & :\approx \frac{v_o}{TWR-1}\\
  \dv_G & :\approx G\cdot PMass^{(Name)}\left(\frac{1}{PRadius^{(Name)}}-\frac{1}{r_o}\right)\\
  \dv_L & :\approx v_o + \dv_D + \dv_G
\end{align}

where $TWR$ denotes the rockets TWR at the begin of the launch at the
launchsite.

As a replacement for the orbital speed the escape velocity
\cite{EscapeVelocity} can be used.

\part{Appendices}

\chapter{Differences to the real world}\label{RealWorldDifferences}

\section{Atmosphere}

In the real world the atmosphere does not stop suddenly at an
altitude.\index{Atmospheric Height}

In KSP every Planetary Body with an atmosphere has an altitude above
of which there is no atmosphere and this altitude can be calculated as
described in equation \eqref{AtmosphericHeightEquation}.

The density of the atmosphere also depends on temperature, weather and
humidity \cite{RealDensity} but KSP does not model these.

\section{Drag}

Drag is directly proportional to the cross-sectional area $A$ of the
ship.  In KSP this value $A$ is approximated by the ships mass $M$ as
described in chapter \ref{DragForce}.

With the Add-Ons FAR \cite{FAR} and NEAR \cite{NEAR} an effort is made
to implement a more realistic atmosphere into KSP.

\section{Lift}

I don't feel comfortable describing effects I don't even have tried to
comprehend yet. So I will just leave this chapter at ``KSP lift
differs greatly from the real world'' and refer the interested reader
to \cite{FAR}.

\section{Gravitational Model}

In the real world every Planetary Body exercises gravitation to all
other bodies.  In KSP a simplified model is used that is based on
Patched Conics \index{Patched Conics} \cite{PatchedConics}.

This simplification states that the space is divided into areas where
only the gravitation of a single planetary body is in effect.  These
areas are mostly spheric, have the same center as the planetary body
and they can contain other such areas, if the planetary body has other
planetary bodies orbiting it.

The name ``Sphere of Influence'' \index{Sphere of Influence} can refer
either to the area itself or to it's radius. This radius can be
calculated according to the formula in \cite{SphereOfInfluence}.

One effect of this model is that one can escape the SOI of a planet
with a velocity that is smaller than the theoretical escape velocity,
\index{Escape Velocity} because it is sufficient to raise the Apoapsis
above the planets SOI.

The Add-On Principia \cite{principia} intends to implement a more
realistic N-Body-Physics \index{N-Body-Physics} model.

\section{Local Gravity}

The local gravity depends in the real world on the density of the
continent below and the form of the planetary body. So the local
gravity differs for locations at the same distance to the planets
center while in KSP the local gravity is constant for all locations on
the same distance.

\section{Engines}

In the real world Rockete-engines do not have a constant thrust and
ISP has a different meaning...

%\section{Index}
\printindex

\begin{thebibliography}{Kerbin}

\bibitem{KSP}
  \url{http://kerbalspaceprogram.com/}

\bibitem{PAO}
  \url{https://github.com/mhoram-kerbin/ascent-optimizer}

\bibitem{Atmo}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Atmosphere}

\bibitem{ACB}
  \url{http://wiki.kerbalspaceprogram.com/wiki/API:CelestialBody}

\bibitem{Wiki}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Main_Page}

\bibitem{Kerbin}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Kerbin}

\bibitem{ECF}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Specific_impulse#Conversion_factor}

\bibitem{Kepler}
  \url{http://en.wikipedia.org/wiki/Kepler_orbit}

\bibitem{RSCK}
  \url{https://downloads.rene-schwarz.com/dc/category/20}

\bibitem{RSKC}
  \url{https://downloads.rene-schwarz.com/dc/category/19}

\bibitem{SPI}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Specific_impulse#Formula}

\bibitem{SIDPER}
  \url{http://en.wikipedia.org/wiki/Sidereal_period}

\bibitem{MulEng}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Specific_impulse#Multiple_engines}

\bibitem{Lift}
  \url{http://forum.kerbalspaceprogram.com/threads/29788-How-to-calculate-lift}

\bibitem{JetEngines}
  \url{http://forum.kerbalspaceprogram.com/threads/67606-Fuel-consumption-as-a-function-of-atmospheric-pressure}

\bibitem{TrueA}
  \url{http://en.wikipedia.org/wiki/True_anomaly}

\bibitem{MeanA}
  \url{http://en.wikipedia.org/wiki/Mean_anomaly}

\bibitem{EccentricA}
  \url{http://en.wikipedia.org/wiki/Eccentric_anomaly}

\bibitem{NeRaMe}
  \url{http://en.wikipedia.org/wiki/Newton\%27s_method}

\bibitem{FAR}
  \url{http://forum.kerbalspaceprogram.com/threads/20451-Ferram-Aerospace-Research}

\bibitem{NEAR}
  \url{http://forum.kerbalspaceprogram.com/threads/86419-NEAR-A-Simpler-Aerodynamics-Model}

\bibitem{torque}
  \url{http://forum.kerbalspaceprogram.com/threads/75916-If-something-has-an-SAS-torque-of-20-what-does-that-actually-mean}

\bibitem{principia}
  \url{http://forum.kerbalspaceprogram.com/threads/68502-Principia-N-Body-Gravitation}

\bibitem{EuclidianVectors}
  \url{http://en.wikipedia.org/wiki/Euclidean_vector}

\bibitem{ScalarProduct}
  \url{http://en.wikipedia.org/wiki/Dot_product}

\bibitem{CrossProduct}
  \url{http://en.wikipedia.org/wiki/Cross_product}

\bibitem{TrigonometricFunctions}
  \url{http://en.wikipedia.org/wiki/Trigonometric_functions}

\bibitem{Differentiation}
  \url{http://en.wikipedia.org/wiki/Derivative}

\bibitem{Exponentiation}
  \url{http://en.wikipedia.org/wiki/Exponentiation}

\bibitem{Logarithm}
  \url{http://en.wikipedia.org/wiki/Natural_logarithm}

\bibitem{VisViva}
  \url{http://en.wikipedia.org/wiki/Vis-viva_equation}

\bibitem{DarknessTime}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Orbit_darkness_time}

\bibitem{PatchedConics}
  \url{http://en.wikipedia.org/wiki/Patched_conic_approximation}

\bibitem{SphereOfInfluence}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Sphere_of_influence}

\bibitem{RealDensity}
  \url{http://en.wikipedia.org/wiki/Density_of_air}

\bibitem{LatLongNote}
  \url{http://forum.kerbalspaceprogram.com/threads/36476?p=1433092#post1433092}

\bibitem{TsiolkovskyRocketEquation}
  \url{http://en.wikipedia.org/wiki/Tsiolkovsky_rocket_equation}

\bibitem{KspSaveOrbit}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Orbit#Orbits_in_the_save_file}

\bibitem{KspTwr}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Thrust-to-weight_ratio}

\bibitem{IntakeAir}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Intake_air}

\bibitem{Air Intakes}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Air_intake}

\bibitem{AirIntakeModel}
  \url{http://forum.kerbalspaceprogram.com/threads/73472-Air-intake-model-stock-KSP}

\bibitem{IntakesDifference}
  \url{http://www.reddit.com/r/KerbalSpaceProgram/comments/1bx1zd/}

\bibitem{DeltaV}
  \url{http://en.wikipedia.org/wiki/Delta-v}

\bibitem{WhatIsDeltaV}
  \url{http://forum.kerbalspaceprogram.com/threads/60189-What-Is-Delta-V}

\bibitem{TsiolkovskyKSP}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Cheat_sheet#Delta-v_.28.CE.94v.29}

\bibitem{GeosynchronousOrbit}
  \url{http://en.wikipedia.org/wiki/Geosynchronous_orbit}

\bibitem{GeostationaryOrbit}
  \url{http://en.wikipedia.org/wiki/Geostationary_orbit}

\bibitem{PayloadFractionChallenge}
  \url{http://forum.kerbalspaceprogram.com/threads/55615-Payload-Fraction-Challenge}

\bibitem{AscentDeltaVApproximation}
  \url{http://forum.kerbalspaceprogram.com/threads/46194-I-need-someone-help-me-do-some-math-for-launch-optimization?p=987663#post987663}

\bibitem{AscentDeltaVApproximationFormula}
  \url{http://forum.kerbalspaceprogram.com/threads/97801-I-need-help-making-a-delta-v-map?p=1495975#post1495975}

\bibitem{EscapeVelocity}
  \url{http://en.wikipedia.org/wiki/Escape_velocity}

\bibitem{DeltaVMaximizationChallenge}
  \url{http://forum.kerbalspaceprogram.com/threads/59823-Delta-V-Maximization-Challenge}

\end{thebibliography}
\end{document}

% Local Variables:
% ispell-local-dictionary:"american";
% End:
