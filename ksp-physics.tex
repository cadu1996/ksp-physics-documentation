\documentclass[11pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[a4paper]{geometry}
\usepackage[pdfstartview=Fit,pdfpagelayout=SinglePage,breaklinks=true]{hyperref}
\usepackage{breakurl}
\usepackage{multicol}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage[final]{listings}
%\usepackage{makeidx}
\makeindex

\newcommand{\oa}[1]{\overrightarrow{#1}}
\newcommand{\F}[1]{\oa{F_{#1}}}
\newcommand{\Pos}{\oa{P}}
\newcommand{\Vel}{\oa{V}}
\newcommand{\absvec}[1]{\left|\left|{#1}\right|\right|}
\newcommand{\dddvec}[3]{\left(\begin{smallmatrix}{#1}\\{#2}\\{#3}\end{smallmatrix}\right)}
\begin{document}

\title{Documentation of KSP Physics\\\small{Version \input{.tagversion}}}
%\author {Mhoram Kerbin \href{mailto:mhoram.kerbin@gmx.de}{\nolinkurl{mhoram.kerbin@gmx.de}}}

\maketitle

\begin{abstract}

  This documents summarizes the physics of Kerbal Space Program \cite{KSP}. It should be valid for versions 0.21 to 0.23.

\end{abstract}

\tableofcontents

\section{Introduction}

During my attempts to use PSOPT as a method for generating ideal
ascent trajectories for rockets, I needed to implement the physics of
KSP in C/C++. So I had to gather all the physics related information
again after my Ascent Optimizer Perl-project \cite{PAO}. Since they
are available at quite different places, this document should
summarize them in a central place.

\section{Conventions}

We denote by $\Pos$, $\Vel$, $d$ and $M$ the position vector, velocity
vector, drag coefficient and the mass of the ship respectively.

$\Pos_X, \Pos_Y \textrm{ and } \Pos_Z$ denote the X, Y and Z
components of the vector.

Distance denotes the distance to the planets center and altitude the
distance to the surface sea level.

\section{Physical Constants}


\subsection{Global Constants}

The \index{conversion factor} conversion factor between pressure and
density is according to \cite{Atmo}.

\begin{align}
  CF &:= 1.2230948554874 \frac{kg}{m^3\cdot atm}
\end{align}

The \index{gravitational constant} gravitational constant $G$ is according to \cite{ACB}.
\begin{align}
  G &:= 6.674E-11 N\left(\frac{m}{kg}\right)^2
\end{align}

\subsection{Planets}

Planets are defined with respect to this problem setting by the
following constants

\begin{itemize}
\item Name
\item \index{Mass of Planet} Mass of Planet $PMass^{(Name)}$ in kg
\item \index{Planetary Radius} Planetary Radius $PRadius^{(Name)}$ in m
\item \index{Scale Height} Scale Height $PSH^{(Name)}$ in m
\item \index{Density at Sealevel} Density at Sealevel $p_0^{(Name)}$ in atm
\item \index{Rotation Period} Rotation Period $RP^{(Name)}$ in s
\item \index{Spehre of Influence} Radius of Spehre of Influence$Soi^{(Name)}$ in m
\end{itemize}

\subsubsection{Kerbin}

This information is based on \cite{Kerbin}.

\begin{align*}
  PMass^{(Kerbin)} &:= 5.2915793E22 kg\\
  PRadius^{(Kerbin)} &:= 600000 m\\
  PSH^{(Kerbin)} &:= 5000 m\\
  p_0^{(Kerbin)} &:= 1 atm\\
  RP^{(Kerbin)} &:= 21600 s\\
  Soi^{(Kerbin)} &:= 84159286 m\\
\end{align*}

\section{Atmosphere}

Now we will show how several atmospheric parameters are calculated
based on \cite{Atmo}.
\begin{align}
  AtmosphericHeight^{(Name)} &:= -ln\left(\frac{10^{-6}}{p_0^{(Name)}}\right)\cdot PSH^{(Name)}\\
  \textrm{Pressure at altitude } p(alt) &:= p_0^{(Name)} \cdot exp\left({\frac{-alt}{PSH^{(Name)}}}\right)\\
  \textrm{Density at altitude } \rho(alt) &:= CF \cdot p(alt)
\end{align}

\section{Latitude and Longitude conversion}

From a Position Vector $\Pos$ we can calculate latitude
and longitude by the following formula:

\begin{align}
  Lon(\Pos) &:= atan\left(\frac{\Pos_Y}{\Pos_X}\right)\\
  Lat(\Pos) &:= atan\left(\frac{\Pos_Z}{\sqrt{\Pos_X^2+\Pos_Y^2}}\right)
\end{align}

\section{Ground Speed}

Due to the rotation of the planet, the groud speed is different from
the orbital speed.

The difference between the two speed vectors $STV(\Pos)$ is the
projected earth rotation to the position $\Pos$ of the rocket.

We can convert orbital $\Vel$ to ground speed $\oa{GV}$
vectors with the following equation.

\begin{align}
  STV(\Pos) &:= \absvec{\Pos} \cdot \frac{2 \pi}{RP^{(Name)}} \cdot cos\left(Lat\left(\Pos\right)\right)\cdot\left(\begin{smallmatrix}-sin(Lon(\Pos)\\cos(Lon(\Pos))\\0\end{smallmatrix}\right)\\
  \oa{GV} &:= \Vel - STV(\Pos)
\end{align}

\section{Drag Coefficient}

In KSP $d$ is the drag coefficient of the rocket. It is a mass-based
average of the drag coefficients of all parts of the rocket and is
dimensionless.

Usually it is near to $0.2$.

Consider a rocket consisting of a Mk1 Cockpit, a FL-T800 Fuel Tank and
a LV-909 Liquid Fuel Engine. For this rocket the drag coefficient is:
\begin{align}
  d &= \frac{1.25 \cdot 0.1 + 4.5 \cdot 0.2 + 0.5 \cdot 0.2}{ 1.25 + 4.5 + 0.5 }\nonumber\\
  &= \frac{1.125}{6.25}\nonumber\\
  &= 0.18\nonumber
\end{align}

\section{Drag}

Drag is the force applied to rocket based on the movement through the
atmosphere it is directed in an opposite direction to the movement.

Since it is directly proportional to the cross-sectional area $A$ of
the rocket and this value is approximated in KSP by $A = 0.008
\frac{m^2}{kg} \cdot M$ we get

\begin{align}
  \F{D} &:= - 0.5 \cdot \rho(alt)\cdot GV^2\cdot d \cdot 0.008\frac{m^2}{kg} \cdot M \cdot \frac{\oa{GV}}{\absvec{\oa{GV}}} \nonumber\\
  &= - 0.5 \cdot \rho(alt)\cdot d \cdot 0.008\frac{m^2}{kg} \cdot M \cdot \absvec{\oa{GV}} \cdot \oa{GV}
\end{align}

\section{Gravity}

The gravity force is directed towards the planets core and gets lower
with increasing distance.

\begin{align}
  \mu^{(Name)} = LocalGravityParameter^{(Name)} &:= G \cdot PMass^{(Name)} \nonumber\\
  LocalGravity(distance) &:= \frac{LocalGravityParameter}{distance^2}\nonumber\\
  \F{G} &:= - M \cdot \mu^{(Name)}\cdot\frac{\Pos}{\absvec{\Pos}^3}
\end{align}

\section{Engines}

The Specific impulse $I_{SP}$ describes the engine efficiency and is
parameterized for an engine by ISP at sealevel and ISP in vacuum.

The ISP is linear in the pressure $p$ and cut off at $1atm$
(citation needed).  We can calculate the ISP based on the pressure
$p$ by
\begin{align}
  np(p) &:= min(1 atm, p)\\
  ISP(p) &:= ISP_{1atm} \cdot np(p) + ISP_{VAC} \cdot (1-np(p))
\end{align}

According to \cite{ECF} the conversion factor $g_0$ is not
$9.81\frac{m}{s^2}$, but
\begin{align}
  g_0 &:= 9.82\frac{m}{s^2}
\end{align}

\section{Orbital Mechanics}

An Orbit can be described either by cartesian coordinates of a
position vector $\Pos$ and a velocity vector $\Vel$ or by kepler
elements \cite{Kepler}

\begin{itemize}
\item Semimajor axis ($a$)
\item Eccentricity ($e$)
\item Inclination ($i$)
\item Longitude of the ascending node ($\Omega$)
\item Argument of periapsis ($\omega$)
\item True Anomaly ($\nu$)
\end{itemize}

This section contains a description of the conversion between Kepler
and Cartesian coordinates.

\subsection{Cartesian}

We can convert cartesian to kepler coordinates by the following
equations courtesy of \cite{RSCK}, where $\mu^{(Name)}$ denotes the
gravitational Parameter of the planet, $\oa{h}$ the orbital momentum
vector and $\oa{e}$ the eccentricity vector.

\begin{align}
  \oa{h} &:= \Pos \times \Vel\nonumber\\
  a &:= \left(2\cdot\absvec{\Pos}^{-1} - \frac{\absvec{\Vel}^2}{\mu^{(Name)}}\cdot \right)^{-1}\\
  \oa{e} &:= \frac{\Vel\times \oa{h}}{\mu^{(Name)}} - \absvec{\Pos}\nonumber\\
  e &:= \absvec{\oa{e}}\\
  i &:= arccos\left(\frac{\oa{h}_Z}{\absvec{\oa{h}}} \right)\\
  \oa{n} & := \dddvec{0}{0}{1} \times \oa{h} = \dddvec{-\oa{h}_Y}{\oa{h}_X}{0}\nonumber\\
  \Omega &:= \left\{
    \begin{array}{l l}
      0 & \textrm{if } \absvec{\oa{n}} = 0\\
      arccos\left(\dddvec{1}{0}{0}\cdot\frac{\oa{n}}{\absvec{\oa{n}}} \right) & \textrm{if } \oa{n}_Y = \oa{h}_X >= 0\\
      2\pi - arccos\left(\dddvec{1}{0}{0}\cdot\frac{\oa{n}}{\absvec{\oa{n}}} \right) & \textrm{otherwise}
    \end{array}
    \right.\\
  \omega & := \left\{
    \begin{array}{l l}
      0 & \textrm{if } \absvec{\oa{n}} = 0\\
      arccos\left(\frac{\oa{n}\cdot\oa{e}}{\absvec{\oa{n}}\cdot\absvec{\oa{e}}} \right) & \textrm{if } \oa{e}_Z >= 0\\
      2\pi - arccos\left(\frac{\oa{n}\cdot\oa{e}}{\absvec{\oa{n}}\cdot\absvec{\oa{e}}}\right) & \textrm{otherwise}
    \end{array}
    \right.\\
    \nu &:= \left\{
    \begin{array}{l l}
      arccos\left(\frac{\Pos\cdot\oa{e}}{\absvec{\Pos}\cdot\absvec{\oa{e}}}\right) & \textrm{if } \Pos\cdot\Vel >= 0\\
      2\pi - arccos\left(\frac{\Pos\cdot\oa{e}}{\absvec{\Pos}\cdot\absvec{\oa{e}}}\right) & \textrm{otherwise}
    \end{array}
    \right.
\end{align}

\subsection{Additional functions}

We can calculate the periapsis $Peri$ as

\begin{align}
Peri & := a \cdot (1 - e)
\end{align}

\begin{thebibliography}{Kerbin}

\bibitem{KSP}
  \url{http://kerbalspaceprogram.com/}

\bibitem{PAO}
  \url{https://github.com/mhoram-kerbin/ascent-optimizer}

\bibitem{Atmo}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Atmosphere}

\bibitem{ACB}
  \url{http://wiki.kerbalspaceprogram.com/wiki/API:CelestialBody}

\bibitem{Kerbin}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Kerbin}

\bibitem{ECF}
  \url{http://wiki.kerbalspaceprogram.com/wiki/Specific_impulse#Conversion_factor}

\bibitem{Kepler}
  \url{http://en.wikipedia.org/wiki/Kepler_orbit}

\bibitem{RSCK}
  \url{https://downloads.rene-schwarz.com/dc/category/20}

\end{thebibliography}

\end{document}

% Local Variables:
% ispell-local-dictionary:"american";
% End:

